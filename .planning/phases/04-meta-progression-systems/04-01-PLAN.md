# Plan 04-01: Persistence & Currency Foundation

## Goal
Establish the save/load architecture and implement the core currency loop. Players should be able to collect currency during a run, die, see their total currency increase, and have it persist across browser sessions.

## Requirements
1.  **ProgressionManager**: A singleton to manage `localStorage` operations for `SaveData`.
2.  **Currency Collection**:
    - Enemies drop "Gold/Essence" on death.
    - Treasure chests contain Gold.
    - UI HUD shows current run gold.
3.  **Game Flow**:
    - **MainMenuScene**: New entry point. Shows total saved gold.
    - **GameScene**: Tracks run gold.
    - **GameOverScene**: Shows "Run Gold" + "Total Gold". Saves progress.
4.  **Data Schema**:
    - `currency`: number
    - `runsCompleted`: number
    - `totalCurrencyCollected`: number

## Detailed Steps
1.  **Create `ProgressionManager.ts`** in `src/systems/`.
    - Define `SaveData` interface.
    - Implement `loadData()`, `saveData()`, `addCurrency()`, `getCurrency()`.
    - Initialize with default values if no save exists.
2.  **Update `GameScene.ts`**:
    - Add `runCurrency` property.
    - Add UI text for currency (Top Left, under HP).
    - In `checkEnemyDeath` (or similar), add random gold drop logic.
    - In `openTreasure` (if exists) or item pickup, add gold.
3.  **Create `MainMenuScene.ts`**:
    - Simple text: "Start Run".
    - Display: "Total Gold: X".
4.  **Create `GameOverScene.ts`**:
    - Display: "Run Ended".
    - Display: "Gold Collected: X".
    - Button: "Return to Menu".
    - On creation, call `ProgressionManager.addCurrency(runCurrency)` and `saveData()`.
5.  **Update `main.ts`**:
    - Add new scenes to the game config.
    - Start with `MainMenuScene` instead of `GameScene`.

## Acceptance Criteria
- [ ] Game starts at Main Menu showing 0 gold (initial).
- [ ] Clicking Start enters GameScene.
- [ ] Killing enemies increments "Run Gold" in HUD.
- [ ] Dying transitions to Game Over screen showing collected gold.
- [ ] Returning to Menu shows updated Total Gold.
- [ ] Reloading the browser preserves Total Gold.
