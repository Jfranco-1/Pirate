# Plan 04-02: Permanent Upgrades

## Goal
Implement a shop system where players can spend collected currency on permanent stat boosts that apply to all future runs.

## Requirements
1.  **Upgrade Definitions**:
    - Defined in code (ID, Name, Description, BaseCost, CostMultiplier, MaxLevel, StatKey).
    - Example Upgrades: "Vitality" (+5 HP), "Strength" (+1 Dmg), "Greed" (+10% Gold).
2.  **UpgradeScene**:
    - Accessible from MainMenu.
    - Lists available upgrades.
    - Shows current level, cost, and "Buy" button.
    - Updates `SaveData` via `ProgressionManager`.
3.  **Apply Upgrades**:
    - `GameScene` (or `Player` constructor) reads `ProgressionManager` upgrades.
    - Apply bonuses to base stats at start of run.

## Detailed Steps
1.  **Define Upgrades**:
    - Create `src/data/Upgrades.ts`.
    - Export `UPGRADES` array/object constant.
2.  **Update `ProgressionManager`**:
    - Add `upgrades` map to `SaveData` (`{ [id]: level }`).
    - Add `buyUpgrade(id)` method: checks currency, deducts cost, increments level, saves.
    - Add `getUpgradeLevel(id)` method.
3.  **Create `UpgradeScene.ts`**:
    - List upgrades in a grid/list.
    - Display current currency.
    - Handle purchase interactions (disable buttons if poor/maxed).
    - "Back" button to MainMenu.
4.  **Update `Player.ts`**:
    - In constructor/init, fetch upgrade levels.
    - Modify initial `maxHP`, `attack`, `defense` based on levels.
    - (e.g., `this.stats.maxHP += upgrades['vitality'] * 5`).
5.  **Update `MainMenuScene`**:
    - Add "Shop" / "Upgrades" button.

## Acceptance Criteria
- [ ] "Upgrades" button in Main Menu works.
- [ ] Shop shows correct costs and affordable status.
- [ ] Buying an upgrade reduces Gold and increases Level.
- [ ] Upgrade levels persist on reload.
- [ ] Starting a run with "Vitality Lvl 1" gives Player higher starting HP.
