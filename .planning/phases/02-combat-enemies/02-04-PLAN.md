# Items & Consumables System Plan

**Goal:** Add a tactical inventory system with consumables (health/buff potions) and throwable items (poison/fire bombs) that integrate with turn-based combat and status effects.

**Scope:** Full items system with 5-slot inventory, stacking, turn-consuming usage, and arrow-key targeting for throwables.

## User Requirements
- **5 inventory slots** (balanced)
- **Item stacking** enabled (e.g., 3x Health Potion in one slot)
- **Using item costs a turn** (tactical decision: use item OR attack)
- **Throwable items require targeting** (arrow keys to select enemy, Enter to confirm)

## Item Types

1. **Health Potion** - Restore 8 HP instantly
2. **Strength Potion** - +3 attack for 3 turns (buff)
3. **Defense Potion** - +3 defense for 3 turns (buff)
4. **Poison Bomb** - Throwable: Apply poison (2 dmg/turn for 4 turns)
5. **Fire Bomb** - Throwable: Apply burn (3 dmg/turn for 3 turns)

---

## Architecture Overview

```
Item System Components:
├── Data Layer (types, definitions)
│   ├── ItemType enum (5 item types)
│   ├── ItemCategory enum (INSTANT, BUFF, THROWABLE)
│   ├── ItemDefinition interface (metadata)
│   └── ItemDatabase (static registry)
├── Entity Layer (world presence)
│   └── WorldItemEntity (gridX/gridY/sprite on map)
├── Inventory Layer (player state)
│   ├── InventoryManager (5 slots, stacking logic)
│   └── InventorySlot (itemType + quantity)
├── UI Layer (visual display)
│   └── InventoryUI (bottom-left panel)
└── Gameplay Integration
    ├── Spawning (random floor tiles, 3-5 items)
    ├── Pickup (automatic on movement)
    ├── Usage (number keys 1-5)
    └── Targeting (arrow keys + Enter)
```

---

## Implementation Order

**Phase A: Foundation (Tasks 1-4)**
1. Data structures (types, enums, interfaces)
2. ItemDatabase (item definitions)
3. InventoryManager (slot logic, stacking)
4. WorldItemEntity (physical item class)

**Phase B: Spawning & Pickup (Tasks 5-7)**
5. Item spawning in GameScene
6. InventoryUI panel
7. Pickup mechanics on movement

**Phase C: Usage & Effects (Tasks 8-9)**
8. Number key input system
9. Consumable effects (instant heal, buffs)

**Phase D: Targeting & Polish (Tasks 10-12)**
10. Targeting system for throwables
11. Particle effects
12. Final integration & testing

---

## Files Summary

### New Files (4)
- `src/systems/ItemDatabase.ts` - CREATE
- `src/systems/InventoryManager.ts` - CREATE
- `src/entities/WorldItem.ts` - CREATE
- `src/ui/InventoryUI.ts` - CREATE

### Modified Files (3)
- `src/types/index.ts` - MODIFY (add item types)
- `src/scenes/GameScene.ts` - MODIFY (spawning, pickup, usage, targeting)
- `src/systems/ParticleSystem.ts` - MODIFY (add fire burst effect)

---

## Technical Notes

**Depth Layering:**
- WorldItem: 50 (below entities)
- Entities: 100
- Particles: 100
- Targeting cursor: 150
- Projectile: 200
- UI panels: 500
- UI contents: 501

**Turn Flow:**
- Item usage triggers `playerMoved = true`
- Flows through `endPlayerTurn()` like movement/attack
- Status effects from items tick each turn
- Throwables apply DoT that persists across turns

**Integration Points:**
- Uses `StatusEffectManager` for buffs/debuffs/DoT
- Uses `FloatingText` for visual feedback
- Uses `ParticleSystem` for effects
- Uses `CombatLog` for messages
- Uses `GridManager` for positioning
- Follows existing entity patterns

**Balance:**
- Health Potion: 8 HP (40% of max HP)
- Buffs: +3 to stat for 3 turns
- Poison: 2 dmg/turn for 4 turns (8 total)
- Burn: 3 dmg/turn for 3 turns (9 total)
- Max stacks: 5 (potions), 3 (bombs)
