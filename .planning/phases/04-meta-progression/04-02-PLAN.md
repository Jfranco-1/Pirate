---
phase: 04-meta-progression
plan: 02
type: execute
---

<objective>
Enhance run summary/death screen and improve game flow between scenes.

Purpose: Death should feel like progress, not failure. A proper run summary shows what was accomplished and currency earned, creating satisfaction even in failure.

Output: Enhanced death screen with run statistics, clear currency gained feedback, and smooth transition back to hub.
</objective>

<context>
@.planning/phases/04-meta-progression/04-01-PLAN.md
@src/scenes/GameScene.ts
@src/scenes/HubScene.ts

**Current state:**
- Game over shows kills and currency
- R key returns to hub
- Meta UI (debug) shows during gameplay

**Improvements needed:**
- Remove redundant debug meta UI during gameplay
- Better visual death screen layout
- Show class played
- Show run duration or turns survived (optional)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance death screen visuals</name>
  <files>src/scenes/GameScene.ts</files>
  <action>Update game over screen to use a panel background (semi-transparent dark box). Show: "RUN ENDED", class name (from meta), kills, currency earned. Use consistent styling with hub. Add subtle animation (fade in).</action>
  <verify>npm run dev, die in game, see improved death screen</verify>
  <done>Death screen has panel background, shows class, animations</done>
</task>

<task type="auto">
  <name>Task 2: Remove debug meta UI during gameplay</name>
  <files>src/scenes/GameScene.ts</files>
  <action>Remove MetaProgressionUI creation and all metaKeys except R (restart). Remove keyboard handlers for H/J/K (upgrades), U/O/P (unlocks), Z/X (class switch), M (toggle), L (reset). Keep only R for returning to hub. This cleans up the interface - all progression happens in hub now.</action>
  <verify>npm run dev, no meta debug panel, R still works to return</verify>
  <done>Debug UI removed, cleaner gameplay screen, R key preserved</done>
</task>

<task type="auto">
  <name>Task 3: Add victory condition check</name>
  <files>src/scenes/GameScene.ts</files>
  <action>After enemy removal, check if all enemies are dead. If yes, show victory screen: "DUNGEON CLEARED!" with bonus currency (e.g., +10). Award bonus via meta.addCurrency(10). Show same R to return. This gives a win state for the run.</action>
  <verify>npm run dev, kill all enemies, see victory screen with bonus</verify>
  <done>Victory screen shows when all enemies killed, bonus awarded</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors
- [ ] Death screen shows panel with class, kills, currency
- [ ] Debug meta UI removed from gameplay
- [ ] Victory screen shows when all enemies killed
- [ ] R key returns to hub from both death and victory
- [ ] Currency correctly awarded (including victory bonus)
</verification>

<success_criteria>
- Clean gameplay UI (no debug panel)
- Enhanced death screen with run summary
- Victory condition with bonus reward
- Smooth hub transition
</success_criteria>
