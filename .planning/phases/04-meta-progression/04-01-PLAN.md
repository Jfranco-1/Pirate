---
phase: 04-meta-progression
plan: 01
type: execute
---

<objective>
Create HubScene with class selection, upgrade shop, and unlock shop UI.

Purpose: Players need a visual way to interact with meta-progression before each run. Currently it's keyboard debug shortcuts. A proper hub scene creates the "one more run" ritual of seeing progress, making purchases, choosing loadout.

Output: HubScene with functional class selection, upgrade purchasing, item/class unlocking, and start run button.
</objective>

<context>
@.planning/phases/04-meta-progression/04-RESEARCH.md
@src/systems/MetaProgressionManager.ts
@src/types/index.ts

**Existing systems:**
- MetaProgressionManager: Currency, upgrades, unlocks, save/load - all working
- CharacterClass: WARRIOR, ROGUE, GUARDIAN
- MetaUpgradeId: MAX_HP, ATTACK, DEFENSE

**Class stats (from MetaProgressionManager):**
- Warrior: 20 HP, 5 ATK, 2 DEF (balanced)
- Rogue: 16 HP, 7 ATK, 1 DEF (glass cannon)
- Guardian: 24 HP, 4 ATK, 4 DEF (tank)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HubScene class</name>
  <files>src/scenes/HubScene.ts</files>
  <action>Create new Phaser scene class HubScene with key 'HubScene'. In create(): get MetaProgressionManager instance. Create dark background (fillRect 0x111111 covering canvas). Add title text "METRIC" at top center (white, 32px). Add currency display at top-right. Create panel areas for class selection, upgrades, and unlocks. Add "START RUN" button at bottom center (clickable text with hover effect). On click, call this.scene.start('GameScene').</action>
  <verify>File exists, TypeScript compiles, imports correct</verify>
  <done>HubScene.ts created with basic layout, title, currency, start button</done>
</task>

<task type="auto">
  <name>Task 2: Add class selection panel</name>
  <files>src/scenes/HubScene.ts</files>
  <action>In HubScene.create(), add class selection section (left side). Create 3 clickable boxes for Warrior/Rogue/Guardian. Each box shows: colored square (green/yellow/blue), class name, stats preview (HP/ATK/DEF). Highlight selected class with border. On click: call meta.setSelectedClass(class), update visual selection. Only show clickable for unlocked classes (use meta.isClassUnlocked). Locked classes show padlock icon or grayed out.</action>
  <verify>npm run dev, classes display correctly, selection works for unlocked, locked classes grayed</verify>
  <done>Class selection panel with visual boxes, stats preview, selection highlighting</done>
</task>

<task type="auto">
  <name>Task 3: Add upgrade shop panel</name>
  <files>src/scenes/HubScene.ts</files>
  <action>In HubScene.create(), add upgrades section (center/right). For each upgrade (MAX_HP, ATTACK, DEFENSE): show name, current level, cost, and [BUY] button. On button click: call meta.purchaseUpgrade(id), refresh display. Gray out button if not enough currency. Show +2 HP per level, +1 ATK per level, +1 DEF per level preview. Update currency display after purchase.</action>
  <verify>npm run dev, upgrade levels display, buy buttons work, currency updates</verify>
  <done>Upgrade shop with buy buttons, cost display, level tracking</done>
</task>

<task type="auto">
  <name>Task 4: Add unlock shop panel</name>
  <files>src/scenes/HubScene.ts</files>
  <action>In HubScene.create(), add unlocks section (bottom area). Show unlockable items: Fire Bomb (25 currency), Rogue class (50 currency), Guardian class (50 currency). For each: if unlocked, show checkmark and "UNLOCKED". If locked, show cost and [UNLOCK] button. On click: call meta.unlockItem() or meta.unlockClass(). Refresh display after purchase. Gray out if insufficient currency.</action>
  <verify>npm run dev, unlocks display correctly, purchase works, state persists</verify>
  <done>Unlock shop with item/class unlocks, purchase buttons, state display</done>
</task>

<task type="auto">
  <name>Task 5: Add lifetime stats display</name>
  <files>src/scenes/HubScene.ts</files>
  <action>In HubScene.create(), add stats section (bottom, above start button). Display from meta.getLifetime(): "Runs: X | Kills: X | Currency Earned: X". Simple white text, centered. This shows players their overall progress.</action>
  <verify>npm run dev, stats display correctly from save data</verify>
  <done>Lifetime stats section showing runs, kills, total currency earned</done>
</task>

<task type="auto">
  <name>Task 6: Update main.ts to start with HubScene</name>
  <files>src/main.ts</files>
  <action>Import HubScene. Add HubScene to Phaser config scene array (before GameScene). Change default scene to 'HubScene' by listing it first in array. Game now starts at hub instead of directly in dungeon.</action>
  <verify>npm run dev opens to hub scene, start run goes to game</verify>
  <done>Game flow: HubScene first, then GameScene on start</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript compiles without errors
- [ ] Game starts at HubScene
- [ ] Currency displays correctly
- [ ] Class selection works (visual feedback, saved to meta)
- [ ] Upgrade purchasing works (costs currency, increases level)
- [ ] Unlock purchasing works (items and classes)
- [ ] Locked classes appear locked in selection
- [ ] Start Run button transitions to GameScene
- [ ] Selected class affects player starting stats
</verification>

<success_criteria>
- HubScene fully functional with all panels
- Class selection with visual feedback
- Upgrade shop with buy functionality
- Unlock shop with buy functionality
- Lifetime stats display
- Scene transition to GameScene
- No TypeScript errors
</success_criteria>
